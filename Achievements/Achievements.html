<div class="card">
    <span class="kpiDisplay All-currency-change" id="prevMP">@User.CommissionsCV.MonthsAgo(1)</span> <!--  Previous Month Personal Sales  -->
    <span class="kpiDisplay All-currency-change" id="prevMT">@User.CommissionsStatsTGVKPI.MonthsAgo(1)</span> <!--  Previous Month Team Sales  -->
    <span class="kpiDisplay" id="prevRank">@User.CommissionsRankName.MonthsAgo(1)</span> <!--  Previous Month Rank  -->
    <span class="kpiDisplay" id="Rank">@User.CommissionsRankName</span> <!--  Current Month Rank  -->
    <span class="kpiDisplay All-currency-change" id="MP">@User.CommissionsCV</span> <!--  Current Month Personal Sales  -->
    <span class="kpiDisplay All-currency-change" id="MT">@User.CommissionsStatsGVKPI</span> <!--  Current Month Team Sales  -->
    <span class="kpiDisplay" id="HRank">@User.CommissionsHighestRankName</span> <!--  Lifetime Highest Rank  -->
    <span class="kpiDisplay" id="AssociateAssociateCountryKPI">@User.AssociateAddressCountryCode</span> <!--  Country Code  -->
    <span class="kpiDisplay All-currency-change" id="NextCappedVolumeKPI">@User.CommissionsStatsNCRV</span> <!--  35% Rule  -->
    <span class="kpiDisplay All-currency-change" id="PrevNextCappedVolumeKPI">@User.CommissionsStatsNCRV.MonthsAgo(1)</span> <!--  Previous 35% Rule  -->
    <span class="kpiDisplay" id="RankVal">@User.CommissionsRank</span> <!--  Rank Value  -->
    <span class="kpiDisplay" id="CMEnrolledPPl">@User.CommissionsStatsLEC</span> <!--  Team Enrolled this month  -->
    <span class="kpiDisplay" id="PrevCMEnrolledPPl">@User.CommissionsStatsLEC.MonthsAgo(1)</span> <!--  Team Enrolled previous month  -->
    <span class="kpiDisplay" id="ATEnrolledPPl">@User.CommissionsStatsGTeam</span> <!--  Total current month Team  -->
    <span class="kpiDisplay" id="PrevATEnrolledPPl">@User.CommissionsStatsGTeam.MonthsAgo(1)</span> <!--  Total previous month Team  -->
    <span class="kpiDisplay All-currency-change" id="InactivePersonalVol">@User.CommissionsStatsNISVKPI</span> <!--  Inactive personal volume  -->
    <span class="kpiDisplay All-currency-change" id="PrevInactivePersonalVol">@User.CommissionsStatsNISVKPI.MonthsAgo(1)</span> <!--  Previous Inactive personal volume  -->
    <span class="kpiDisplay" id="AssociateIDA">@User.AssociateAssociateID</span>

    <a href="app.html#/TeamDashboard"><div class="card-header" id="businessSNHeader-2v"><h1>Business Snapshot</h1></div></a>
    <div id="titleButtonChng">
        <div class="BSHeaderT item-alpha" id="BSHeaderTAfterChange"><h1 class="BSTitle">Current</h1></div>
        <div class="BSHeaderT item-beta" id="secondtlt"><h1 class="BSTitle">Previous</h1></div>
    </div>
    <div class="card-body" id="achievements-wg-grid-2v">
        <div class="ach-item-a-2v ach-metric-main-div-2v">
            <div class="ach-metric-div-2v">
                <h1 id="All-metric-multy-1"></h1>
            </div>
            <div class="ach-metric-div-2v">
                <h2 id="All-metric-multy-1tlt"></h2>
            </div>
        </div>
        <div class="ach-item-b-2v ach-metric-main-div-2v">
            <div class="ach-metric-div-2v">
                <h1 id="All-metric-multy-2"></h1>
            </div>
            <div class="ach-metric-div-2v">
                <h2 id="All-metric-multy-2tlt"></h2>
            </div>
        </div>
        <div class="ach-item-c-2v ach-metric-main-div-2v">
            <div class="ach-metric-div-2v">
                <h1 id="All-metric-multy-3"></h1>
            </div>
            <div class="ach-metric-div-2v">
                <h2 id="All-metric-multy-3tlt"></h2>
            </div>
        </div>
        <div class="ach-item-d-2v ach-metric-main-div-2v" ondblclick="Confetti(false)">
            <div class="ach-metric-div-2v">
                <h1 id="All-metric-multy-4"></h1>
            </div>
            <div class="ach-metric-div-2v">
                <h2 id="All-metric-multy-4tlt"></h2>
            </div>
        </div>
    </div>
    <!--  Last additions  -->
    <div class="prev-next-control">
        <a class="AchievementControlerClass" onclick="CurrentAchievementsPageTwo()">❮</a>
        <a class="AchievementControlerClassDos" onclick="CurrentAchievementsPageTwo()">❯</a>
    </div>
</div>
<script>
    var AssociateIDA = $('#AssociateIDA')[0].innerHTML;
    var ActiveLinesAchievement = 0;
    var APIrequestA = {
        "async": true,
        "crossDomain": true,
        "url": "https://vast-hamlet-17171.herokuapp.com/https://dsapi.directscale.com/v1/customers/"+ AssociateIDA +"/stats",
        "method": "GET",
        "headers": {
            "Content-Type": "application/json",
            "Referer": "https://office2.businessbombshells.team/app.html",
            "Ocp-Apim-Subscription-Key": "98b198fed48d4aceb8d362c2c931572d",
            "Origin": "https://office2.businessbombshells.team",
            "Authorization": "Bearer undefined"
        },
        "processData": false,
        "data": ""
    };

    $.ajax(APIrequestA).done(function (response) {
        ActiveLinesAchievement = response.RankOptions[13].Groups[0].Options[3].Value;
    });
    $(document).ready(function () {
        let CountryCodeA = $('#AssociateAssociateCountryKPI')[0].innerHTML;
        let RankValue = $('#RankVal')[0].innerHTML;

        if (CountryCodeA === 'AU'){
            for(let i = 0; i < $(".All-currency-change").length; i++){
                $(".All-currency-change")[i].innerHTML = $(".All-currency-change")[i].innerHTML * 2;
            }
        }
        else if (CountryCodeA === 'GB'){
            for(let i = 0; i < $(".All-currency-change").length; i++){
                $(".All-currency-change")[i].innerHTML = $(".All-currency-change")[i].innerHTML * 1;
            }
        }
        else{
            for(let i = 0; i < $(".All-currency-change").length; i++){
                $(".All-currency-change")[i].innerHTML = $(".All-currency-change")[i].innerHTML * 1.2;
            }
        }

        let a = document.getElementById("All-metric-multy-1").innerHTML;
        document.getElementById("All-metric-multy-1").innerHTML = Math.floor(a);
        a = document.getElementById("All-metric-multy-2").innerHTML;
        document.getElementById("All-metric-multy-2").innerHTML = Math.floor(a);
        a = document.getElementById("MT").innerHTML;
        document.getElementById("MT").innerHTML = Math.floor(a);
        a = document.getElementById("prevMT").innerHTML;
        document.getElementById("prevMT").innerHTML = Math.floor(a);
        a = document.getElementById("MP").innerHTML;
        document.getElementById("MP").innerHTML = Math.floor(a);
        a = document.getElementById("prevMP").innerHTML;
        document.getElementById("prevMP").innerHTML = Math.floor(a);
        a = document.getElementById("NextCappedVolumeKPI").innerHTML;
        document.getElementById("NextCappedVolumeKPI").innerHTML = Math.floor(a);
        a = document.getElementById("InactivePersonalVol").innerHTML;
        document.getElementById("InactivePersonalVol").innerHTML = Math.floor(a);
        a = document.getElementById("PrevInactivePersonalVol").innerHTML;
        document.getElementById("PrevInactivePersonalVol").innerHTML = Math.floor(a);
        a = document.getElementById("PrevNextCappedVolumeKPI").innerHTML;
        document.getElementById("PrevNextCappedVolumeKPI").innerHTML = Math.floor(a);
        if (CountryCodeA === 'AU'){
            for(let i = 0; i < $(".All-currency-change").length; i++){
                $(".All-currency-change")[i].innerHTML = 'A$' + $(".All-currency-change")[i].innerHTML;
            }
        }
        else if (CountryCodeA === 'GB'){
            for(let i = 0; i < $(".All-currency-change").length; i++){
                $(".All-currency-change")[i].innerHTML = '£' + $(".All-currency-change")[i].innerHTML;
            }
        }
        else {
            for(let i = 0; i < $(".All-currency-change").length; i++){
                $(".All-currency-change")[i].innerHTML = '€' + $(".All-currency-change")[i].innerHTML;
            }
        }
        $("#All-metric-multy-1tlt").text('Current\nTeam Sales');
        $("#All-metric-multy-2tlt").text('Current\nPersonal Sales');
        $("#All-metric-multy-3tlt").text('Current\nPosition');
        $("#All-metric-multy-4tlt").text('Lifetime Highest\nPosition');
        $("#All-metric-multy-1").text($("#MT").text());
        $("#All-metric-multy-2").text($("#MP").text());
        $("#All-metric-multy-3").text($("#Rank").text());
        $("#All-metric-multy-4").text($("#HRank").text());
        $("#BSTitle").text('Current');

        let countMapCurrentLoc = 2;

        // On Click
        $("#titleButtonChng").click(function () {
            countMapCurrentLoc += 1;
            if(countMapCurrentLoc % 2 === 1){
                $("#All-metric-multy-1tlt").text('Current\nTeam Sales');
                $("#All-metric-multy-2tlt").text('Current\nPersonal Sales');
                $("#All-metric-multy-3tlt").text('Current\nPosition');
                $("#All-metric-multy-4tlt").text('Lifetime Highest\nPosition');
                $("#All-metric-multy-1").text($("#MT").text());
                $("#All-metric-multy-2").text($("#MP").text());
                $("#All-metric-multy-3").text($("#Rank").text());
                $("#All-metric-multy-4").text($("#HRank").text());
            }
            else{
                $("#All-metric-multy-1tlt").text('Previous\nTeam Sales');
                $("#All-metric-multy-2tlt").text('Previous\nPersonal Sales');
                $("#All-metric-multy-3tlt").text('Previous\nPosition');
                $("#All-metric-multy-4tlt").text('Lifetime Highest\nPosition');
                $("#All-metric-multy-1").text($("#prevMT").text());
                $("#All-metric-multy-2").text($("#prevMP").text());
                $("#All-metric-multy-3").text($("#prevRank").text());
                $("#All-metric-multy-4").text($("#HRank").text());
            }

            // Team Sales
            $("#All-metric-multy-1").fadeOut(10, function () {
                $("#All-metric-multy-1").text(($("#All-metric-multy-1").text() === $("#MT").text()) ? $("#prevMT").text() : $("#MT").text()).fadeIn();
            })
            $("#All-metric-multy-1tlt").fadeOut(10, function () {
                $("#All-metric-multy-1tlt").text(($("#All-metric-multy-1tlt").text() === 'Current\nTeam Sales') ? 'Previous\nTeam Sales' : 'Current\nTeam Sales').fadeIn();
            })

            // Personal Sales
            $("#All-metric-multy-2").fadeOut(10, function () {
                $("#All-metric-multy-2").text(($("#All-metric-multy-2").text() === $("#MP").text()) ? $("#prevMP").text() : $("#MP").text()).fadeIn();
            })
            $("#All-metric-multy-2tlt").fadeOut(10, function () {
                $("#All-metric-multy-2tlt").text(($("#All-metric-multy-2tlt").text() === 'Current\nPersonal Sales') ? 'Previous\nPersonal Sales' : 'Current\nPersonal Sales').fadeIn();
            })

            // Rank
            $("#All-metric-multy-3").fadeOut(10, function () {
                $("#All-metric-multy-3").text(($("#All-metric-multy-3").text() === $("#Rank").text()) ? $("#prevRank").text() : $("#Rank").text()).fadeIn();
            })
            $("#All-metric-multy-3tlt").fadeOut(10, function () {
                $("#All-metric-multy-3tlt").text(($("#All-metric-multy-3tlt").text() === 'Current\nPosition') ? 'Previous\nPosition' : 'Current\nPosition').fadeIn();
            })


            // Main Title
            $("#BSTitle").fadeOut(10, function () {
                $("#BSTitle").text(($("#BSTitle").text() === 'Current') ? 'Previous' : 'Current').fadeIn();
            })

            // Color Change
            $('.item-alpha').attr('id', function(index, attr){
                return attr === 'BSHeaderTAfterChange' ? 'firsttlt' : 'BSHeaderTAfterChange';
            });
            $('.item-beta').attr('id', function(index, attr){
                return attr === 'secondtlt' ? 'BSHeaderTAfterChange' : 'secondtlt';
            });

            // Controller function changer
            $('.AchievementControlerClass').attr('onclick', function (index, attr){
                return attr === 'CurrentAchievementsPageTwo()' ? 'PreviousAchievementsPageTwo()' : 'CurrentAchievementsPageTwo()';
            });
            $('.AchievementControlerClassDos').attr('onclick', function (index, attr){
                return attr === 'CurrentAchievementsPageTwo()' ? 'PreviousAchievementsPageTwo()' : 'CurrentAchievementsPageTwo()';
            });
        });

        console.log("Easter egg: you found me girl, you're the chosen one");
    });

    // This function if for page two of current stats
    function CurrentAchievementsPageTwo(){
        let RankValue = $('#RankVal')[0].innerHTML;
        $("#All-metric-multy-1").fadeOut(10, function () {
            $("#All-metric-multy-1").text(($("#All-metric-multy-1").text() === $("#MT").text()) ? $("#CMEnrolledPPl").text() : $("#MT").text()).fadeIn();
        })
        $("#All-metric-multy-1tlt").fadeOut(10, function () {
            $("#All-metric-multy-1tlt").text(($("#All-metric-multy-1tlt").text() === 'Current\nTeam Sales') ? 'New Team\nThis Month' : 'Current\nTeam Sales').fadeIn();
        })

        $("#All-metric-multy-2").fadeOut(10, function () {
            $("#All-metric-multy-2").text(($("#All-metric-multy-2").text() === $("#MP").text()) ? $("#ATEnrolledPPl").text() : $("#MP").text()).fadeIn();
        })
        $("#All-metric-multy-2tlt").fadeOut(10, function () {
            $("#All-metric-multy-2tlt").text(($("#All-metric-multy-2tlt").text() === 'Current\nPersonal Sales') ? 'Total Team\nThis Month' : 'Current\nPersonal Sales').fadeIn();
        })
        $("#All-metric-multy-3").fadeOut(10, function () {
            $("#All-metric-multy-3").text(($("#All-metric-multy-3").text() === $("#Rank").text()) ? ActiveLinesAchievement : $("#Rank").text()).fadeIn();
        })
        $("#All-metric-multy-3tlt").fadeOut(10, function () {
            $("#All-metric-multy-3tlt").text(($("#All-metric-multy-3tlt").text() === 'Current\nPosition') ? 'Active Lines' : 'Current\nPosition').fadeIn();
        })
        if(RankValue > 30){
            $("#All-metric-multy-4").fadeOut(10, function () {
                $("#All-metric-multy-4").text(($("#All-metric-multy-4").text() === $("#HRank").text()) ? $("#InactivePersonalVol").text() : $("#HRank").text()).fadeIn();
            })
            $("#All-metric-multy-4tlt").fadeOut(10, function () {
                $("#All-metric-multy-4tlt").text(($("#All-metric-multy-4tlt").text() === 'Lifetime Highest\nPosition') ? 'Current Inactive\nSales Volume' : 'Lifetime Highest\nPosition').fadeIn();
            })
        }
        else{
            $("#All-metric-multy-4").fadeOut(10, function () {
                $("#All-metric-multy-4").text(($("#All-metric-multy-4").text() === $("#HRank").text()) ? '' : $("#HRank").text()).fadeIn();
            })
            $("#All-metric-multy-4tlt").fadeOut(10, function () {
                $("#All-metric-multy-4tlt").text(($("#All-metric-multy-4tlt").text() === 'Lifetime Highest\nPosition') ? '' : 'Lifetime Highest\nPosition').fadeIn();
            })
        }
    }

    // This function if for page two of previous stats
    function PreviousAchievementsPageTwo(){
        let RankValue = $('#RankVal')[0].innerHTML;
        $("#All-metric-multy-1").fadeOut(10, function () {
            $("#All-metric-multy-1").text(($("#All-metric-multy-1").text() === $("#prevMT").text()) ? $("#PrevCMEnrolledPPl").text() : $("#prevMT").text()).fadeIn();
        })
        $("#All-metric-multy-1tlt").fadeOut(10, function () {
            $("#All-metric-multy-1tlt").text(($("#All-metric-multy-1tlt").text() === 'Previous\nTeam Sales') ? 'Previous\nNew Team' : 'Previous\nTeam Sales').fadeIn();
        })

        $("#All-metric-multy-2").fadeOut(10, function () {
            $("#All-metric-multy-2").text(($("#All-metric-multy-2").text() === $("#prevMP").text()) ? $("#PrevATEnrolledPPl").text() : $("#prevMP").text()).fadeIn();
        })
        $("#All-metric-multy-2tlt").fadeOut(10, function () {
            $("#All-metric-multy-2tlt").text(($("#All-metric-multy-2tlt").text() === 'Previous\nPersonal Sales') ? 'Previous\nTotal Team' : 'Previous\nPersonal Sales').fadeIn();
        })
        if(RankValue > 30){
            $("#All-metric-multy-3").fadeOut(10, function () {
                $("#All-metric-multy-3").text(($("#All-metric-multy-3").text() === $("#prevRank").text()) ? $("#PrevInactivePersonalVol").text() : $("#prevRank").text()).fadeIn();
            })
            $("#All-metric-multy-3tlt").fadeOut(10, function () {
                $("#All-metric-multy-3tlt").text(($("#All-metric-multy-3tlt").text() === 'Previous\nPosition') ? 'Previous Inactive\nSales Volume' : 'Previous\nPosition').fadeIn();
            })
            $("#All-metric-multy-4").fadeOut(10, function () {
                $("#All-metric-multy-4").text(($("#All-metric-multy-4").text() === $("#HRank").text()) ? '' : $("#HRank").text()).fadeIn();
            })
            $("#All-metric-multy-4tlt").fadeOut(10, function () {
                $("#All-metric-multy-4tlt").text(($("#All-metric-multy-4tlt").text() === 'Lifetime Highest\nPosition') ? '' : 'Lifetime Highest\nPosition').fadeIn();
            })
        }
        else{
            $("#All-metric-multy-3").fadeOut(10, function () {
                $("#All-metric-multy-3").text(($("#All-metric-multy-3").text() === $("#prevRank").text()) ? '' : $("#prevRank").text()).fadeIn();
            })
            $("#All-metric-multy-3tlt").fadeOut(10, function () {
                $("#All-metric-multy-3tlt").text(($("#All-metric-multy-3tlt").text() === 'Previous\nPosition') ? '' : 'Previous\nPosition').fadeIn();
            })
            $("#All-metric-multy-4").fadeOut(10, function () {
                $("#All-metric-multy-4").text(($("#All-metric-multy-4").text() === $("#HRank").text()) ? '' : $("#HRank").text()).fadeIn();
            })
            $("#All-metric-multy-4tlt").fadeOut(10, function () {
                $("#All-metric-multy-4tlt").text(($("#All-metric-multy-4tlt").text() === 'Lifetime Highest\nPosition') ? '' : 'Lifetime Highest\nPosition').fadeIn();
            })
        }
    }
    function Confetti(Discret){
        var onlyOnKonami = Discret;
        // Globals
        var $window = $(window)
            , random = Math.random
            , cos = Math.cos
            , sin = Math.sin
            , PI = Math.PI
            , PI2 = PI * 2
            , timer = undefined
            , frame = undefined
            , confetti = [];

        var runFor = 2000
        var isRunning = true

        setTimeout(() => {
            isRunning = false
        }, runFor);

        // Settings
        var konami = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65]
            , pointer = 0;

        var particles = 150
            , spread = 20
            , sizeMin = 5
            , sizeMax = 12 - sizeMin
            , eccentricity = 10
            , deviation = 100
            , dxThetaMin = -.1
            , dxThetaMax = -dxThetaMin - dxThetaMin
            , dyMin = .13
            , dyMax = .18
            , dThetaMin = .4
            , dThetaMax = .7 - dThetaMin;

        var colorThemes = [
            function() {
                return colorThemes[random() < 5 ? Math.floor(Math.random() * 3) + 1 : 1]();
            },function() {
                return color(212, 175, 55);
            },function() {
                return color(252, 168, 189);
            }, function() {
                return color(255, 235, 232);
            }, function() {
                return color(242, 179, 174);
            }
        ];
        function color(r, g, b) {
            return 'rgb(' + r + ',' + g + ',' + b + ')';
        }

        // Cosine interpolation
        function interpolation(a, b, t) {
            return (1-cos(PI*t))/2 * (b-a) + a;
        }

        // Create a 1D Maximal Poisson Disc over [0, 1]
        var radius = 1/eccentricity, radius2 = radius+radius;
        function createPoisson() {
            // domain is the set of points which are still available to pick from
            // D = union{ [d_i, d_i+1] | i is even }
            var domain = [radius, 1-radius], measure = 1-radius2, spline = [0, 1];
            while (measure) {
                var dart = measure * random(), i, l, interval, a, b, c, d;

                // Find where dart lies
                for (i = 0, l = domain.length, measure = 0; i < l; i += 2) {
                    a = domain[i], b = domain[i+1], interval = b-a;
                    if (dart < measure+interval) {
                        spline.push(dart += a-measure);
                        break;
                    }
                    measure += interval;
                }
                c = dart-radius, d = dart+radius;

                // Update the domain
                for (i = domain.length-1; i > 0; i -= 2) {
                    l = i-1, a = domain[l], b = domain[i];
                    // c---d          c---d  Do nothing
                    //   c-----d  c-----d    Move interior
                    //   c--------------d    Delete interval
                    //         c--d          Split interval
                    //       a------b
                    if (a >= c && a < d)
                        if (b > d) domain[l] = d; // Move interior (Left case)
                        else domain.splice(l, 2); // Delete interval
                    else if (a < c && b > c)
                        if (b <= d) domain[i] = c; // Move interior (Right case)
                        else domain.splice(i, 0, c, d); // Split interval
                }

                // Re-measure the domain
                for (i = 0, l = domain.length, measure = 0; i < l; i += 2)
                    measure += domain[i+1]-domain[i];
            }

            return spline.sort();
        }

        // Create the overarching container
        var container = document.createElement('div');
        container.style.position = 'fixed';
        container.style.top      = '0';
        container.style.left     = '0';
        container.style.width    = '100%';
        container.style.height   = '0';
        container.style.overflow = 'visible';
        container.style.zIndex   = '9999';

        // Confetto constructor
        function Confetto(theme) {
            this.frame = 0;
            this.outer = document.createElement('div');
            this.inner = document.createElement('div');
            this.outer.appendChild(this.inner);

            var outerStyle = this.outer.style, innerStyle = this.inner.style;
            outerStyle.position = 'absolute';
            outerStyle.width  = (sizeMin + sizeMax * random()) + 'px';
            outerStyle.height = (sizeMin + sizeMax * random()) + 'px';
            innerStyle.width  = '100%';
            innerStyle.height = '100%';
            innerStyle.backgroundColor = theme();

            outerStyle.perspective = '50px';
            outerStyle.transform = 'rotate(' + (360 * random()) + 'deg)';
            this.axis = 'rotate3D(' +
                cos(360 * random()) + ',' +
                cos(360 * random()) + ',0,';
            this.theta = 360 * random();
            this.dTheta = dThetaMin + dThetaMax * random();
            innerStyle.transform = this.axis + this.theta + 'deg)';

            this.x = $window.width() * random();
            this.y = -deviation;
            this.dx = sin(dxThetaMin + dxThetaMax * random());
            this.dy = dyMin + dyMax * random();
            outerStyle.left = this.x + 'px';
            outerStyle.top  = this.y + 'px';

            // Create the periodic spline
            this.splineX = createPoisson();
            this.splineY = [];
            for (var i = 1, l = this.splineX.length-1; i < l; ++i)
                this.splineY[i] = deviation * random();
            this.splineY[0] = this.splineY[l] = deviation * random();

            this.update = function(height, delta) {
                this.frame += delta;
                this.x += this.dx * delta;
                this.y += this.dy * delta;
                this.theta += this.dTheta * delta;

                // Compute spline and convert to polar
                var phi = this.frame % 7777 / 7777, i = 0, j = 1;
                while (phi >= this.splineX[j]) i = j++;
                var rho = interpolation(
                    this.splineY[i],
                    this.splineY[j],
                    (phi-this.splineX[i]) / (this.splineX[j]-this.splineX[i])
                );
                phi *= PI2;

                outerStyle.left = this.x + rho * cos(phi) + 'px';
                outerStyle.top  = this.y + rho * sin(phi) + 'px';
                innerStyle.transform = this.axis + this.theta + 'deg)';
                return this.y > height+deviation;
            };
        }


        function poof() {
            if (!frame) {
                // Append the container
                document.body.appendChild(container);

                // Add confetti

                var theme = colorThemes[onlyOnKonami ? colorThemes.length * random()|0 : 0]
                    , count = 0;

                (function addConfetto() {

                    if (onlyOnKonami && ++count > particles)
                        return timer = undefined;

                    if (isRunning) {
                        var confetto = new Confetto(theme);
                        confetti.push(confetto);

                        container.appendChild(confetto.outer);
                        timer = setTimeout(addConfetto, spread * random());
                    }
                })(0);


                // Start the loop
                var prev = undefined;
                requestAnimationFrame(function loop(timestamp) {
                    var delta = prev ? timestamp - prev : 0;
                    prev = timestamp;
                    var height = $window.height();

                    for (var i = confetti.length-1; i >= 0; --i) {
                        if (confetti[i].update(height, delta)) {
                            container.removeChild(confetti[i].outer);
                            confetti.splice(i, 1);
                        }
                    }

                    if (timer || confetti.length)
                        return frame = requestAnimationFrame(loop);

                    // Cleanup
                    document.body.removeChild(container);
                    frame = undefined;
                });
            }
        }

        $window.keydown(function(event) {
            pointer = konami[pointer] === event.which
                ? pointer+1
                : +(event.which === konami[0]);
            if (pointer === konami.length) {
                pointer = 0;
                poof();
            }
        });

        if (!onlyOnKonami) poof();
        console.log('function = ' + Discret);
    }
</script>